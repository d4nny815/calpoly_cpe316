/*
 * FuncGen.h
 *
 *  Created on: Apr 26, 2024
 *      Author: danny
 */

#ifndef SRC_FUNCGEN_H_
#define SRC_FUNCGEN_H_

#include "stm32l476xx.h"
#include "keypad.h"

#define CPU_FREQ 4000000
#define MAX_FUNC_VOLTAGE 3000
#define MIN_FUNC_VOLTAGE 0
#define ARR_BIT TIM_SR_UIF
#define CCR1_BIT TIM_SR_CC1IF
#define FREQ_MIN 100
#define NEXT_PERIOD 156 // T_max * F_cpu / LUT_size = CCR
#define LUT_SIZE 0xff


#define isFreqChangePin(x) ((uint8_t)x >= 1 && (uint8_t)x <= 5)
#define isWaveChangePin(x) ((uint8_t)x >= 6 && (uint8_t)x <= 9)
#define isDutyChangePin(x) ((uint8_t)x == 0 || (uint8_t)x == KEYPAD_STAR || (uint8_t)x == KEYPAD_POUND)


void square_wave_init(uint16_t freq, uint8_t duty_cycle);
void continous_mode_init(void);

const uint16_t SAWTOOTH_LUT[LUT_SIZE + 1] = {12288, 12302, 12317, 12331, 12346, 12360, 12375, 12389, 12404, 12418, 12433, 12447, 12462, 12477, 12491, 12506, 12520, 12535, 12549, 12564, 12578, 12593, 12607, 12622, 12637, 12651, 12666, 12680, 12695, 12709, 12724, 12738, 12753, 12767, 12782, 12796, 12811, 12826, 12840, 12855, 12869, 12884, 12898, 12913, 12927, 12942, 12956, 12971, 12986, 13000, 13015, 13029, 13044, 13058, 13073, 13087, 13102, 13116, 13131, 13145, 13160, 13175, 13189, 13204, 13218, 13233, 13247, 13262, 13276, 13291, 13305, 13320, 13335, 13349, 13364, 13378, 13393, 13407, 13422, 13436, 13451, 13465, 13480, 13494, 13509, 13524, 13538, 13553, 13567, 13582, 13596, 13611, 13625, 13640, 13654, 13669, 13684, 13698, 13713, 13727, 13742, 13756, 13771, 13785, 13800, 13814, 13829, 13843, 13858, 13873, 13887, 13902, 13916, 13931, 13945, 13960, 13974, 13989, 14003, 14018, 14033, 14047, 14062, 14076, 14091, 14105, 14120, 14134, 14149, 14163, 14178, 14192, 14207, 14222, 14236, 14251, 14265, 14280, 14294, 14309, 14323, 14338, 14352, 14367, 14382, 14396, 14411, 14425, 14440, 14454, 14469, 14483, 14498, 14512, 14527, 14541, 14556, 14571, 14585, 14600, 14614, 14629, 14643, 14658, 14672, 14687, 14701, 14716, 14731, 14745, 14760, 14774, 14789, 14803, 14818, 14832, 14847, 14861, 14876, 14891, 14905, 14920, 14934, 14949, 14963, 14978, 14992, 15007, 15021, 15036, 15050, 15065, 15080, 15094, 15109, 15123, 15138, 15152, 15167, 15181, 15196, 15210, 15225, 15240, 15254, 15269, 15283, 15298, 15312, 15327, 15341, 15356, 15370, 15385, 15399, 15414, 15429, 15443, 15458, 15472, 15487, 15501, 15516, 15530, 15545, 15559, 15574, 15589, 15603, 15618, 15632, 15647, 15661, 15676, 15690, 15705, 15719, 15734, 15748, 15763, 15778, 15792, 15807, 15821, 15836, 15850, 15865, 15879, 15894, 15908, 15923, 15938, 15952, 15967, 15981, 15996};
const uint16_t SINE_LUT[LUT_SIZE + 1] = {14149, 14195, 14240, 14286, 14331, 14377, 14422, 14467, 14512, 14557, 14601, 14645, 14689, 14733, 14776, 14819, 14861, 14903, 14945, 14986, 15026, 15066, 15106, 15145, 15183, 15221, 15258, 15294, 15330, 15365, 15399, 15432, 15465, 15497, 15528, 15558, 15588, 15616, 15644, 15671, 15697, 15721, 15745, 15768, 15790, 15811, 15832, 15851, 15869, 15886, 15901, 15916, 15930, 15943, 15954, 15965, 15974, 15983, 15990, 15996, 16001, 16005, 16008, 16010, 16010, 16010, 16008, 16005, 16001, 15996, 15990, 15983, 15974, 15965, 15954, 15943, 15930, 15916, 15901, 15886, 15869, 15851, 15832, 15811, 15790, 15768, 15745, 15721, 15697, 15671, 15644, 15616, 15588, 15558, 15528, 15497, 15465, 15432, 15399, 15365, 15330, 15294, 15258, 15221, 15183, 15145, 15106, 15066, 15026, 14986, 14945, 14903, 14861, 14819, 14776, 14733, 14689, 14645, 14601, 14557, 14512, 14467, 14422, 14377, 14331, 14286, 14240, 14195, 14149, 14103, 14058, 14012, 13966, 13921, 13876, 13831, 13786, 13741, 13697, 13652, 13609, 13565, 13522, 13479, 13437, 13395, 13353, 13312, 13271, 13231, 13192, 13153, 13115, 13077, 13040, 13004, 12968, 12933, 12899, 12865, 12833, 12801, 12770, 12739, 12710, 12681, 12654, 12627, 12601, 12576, 12552, 12529, 12507, 12486, 12466, 12447, 12429, 12412, 12396, 12381, 12368, 12355, 12343, 12333, 12323, 12315, 12308, 12301, 12296, 12293, 12290, 12288, 12288, 12288, 12290, 12293, 12296, 12301, 12308, 12315, 12323, 12333, 12343, 12355, 12368, 12381, 12396, 12412, 12429, 12447, 12466, 12486, 12507, 12529, 12552, 12576, 12601, 12627, 12654, 12681, 12710, 12739, 12770, 12801, 12833, 12865, 12899, 12933, 12968, 13004, 13040, 13077, 13115, 13153, 13192, 13231, 13271, 13312, 13353, 13395, 13437, 13479, 13522, 13565, 13609, 13652, 13697, 13741, 13786, 13831, 13876, 13921, 13966, 14012, 14058, 14103};
const uint16_t TRIANGLE_LUT[LUT_SIZE + 1] = {12288, 12317, 12346, 12375, 12404, 12433, 12462, 12491, 12520, 12549, 12578, 12607, 12637, 12666, 12695, 12724, 12753, 12782, 12811, 12840, 12869, 12898, 12927, 12956, 12986, 13015, 13044, 13073, 13102, 13131, 13160, 13189, 13218, 13247, 13276, 13305, 13335, 13364, 13393, 13422, 13451, 13480, 13509, 13538, 13567, 13596, 13625, 13654, 13684, 13713, 13742, 13771, 13800, 13829, 13858, 13887, 13916, 13945, 13974, 14003, 14033, 14062, 14091, 14120, 14149, 14178, 14207, 14236, 14265, 14294, 14323, 14352, 14382, 14411, 14440, 14469, 14498, 14527, 14556, 14585, 14614, 14643, 14672, 14701, 14731, 14760, 14789, 14818, 14847, 14876, 14905, 14934, 14963, 14992, 15021, 15050, 15080, 15109, 15138, 15167, 15196, 15225, 15254, 15283, 15312, 15341, 15370, 15399, 15429, 15458, 15487, 15516, 15545, 15574, 15603, 15632, 15661, 15690, 15719, 15748, 15778, 15807, 15836, 15865, 15894, 15923, 15952, 15981, 16010, 15981, 15952, 15923, 15894, 15865, 15836, 15807, 15778, 15748, 15719, 15690, 15661, 15632, 15603, 15574, 15545, 15516, 15487, 15458, 15429, 15399, 15370, 15341, 15312, 15283, 15254, 15225, 15196, 15167, 15138, 15109, 15080, 15050, 15021, 14992, 14963, 14934, 14905, 14876, 14847, 14818, 14789, 14760, 14731, 14701, 14672, 14643, 14614, 14585, 14556, 14527, 14498, 14469, 14440, 14411, 14382, 14352, 14323, 14294, 14265, 14236, 14207, 14178, 14149, 14120, 14091, 14062, 14033, 14003, 13974, 13945, 13916, 13887, 13858, 13829, 13800, 13771, 13742, 13713, 13684, 13654, 13625, 13596, 13567, 13538, 13509, 13480, 13451, 13422, 13393, 13364, 13335, 13305, 13276, 13247, 13218, 13189, 13160, 13131, 13102, 13073, 13044, 13015, 12986, 12956, 12927, 12898, 12869, 12840, 12811, 12782, 12753, 12724, 12695, 12666, 12637, 12607, 12578, 12549, 12520, 12491, 12462, 12433, 12404, 12375, 12346, 12317};


#endif /* SRC_FUNCGEN_H_ */
